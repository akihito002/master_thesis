{"cells":[{"cell_type":"code","execution_count":1,"metadata":{"id":"22e8483b","executionInfo":{"status":"ok","timestamp":1672565026256,"user_tz":-540,"elapsed":633,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}}},"outputs":[],"source":["import pandas as pd\n","import numpy as np\n","import math \n","import io\n","import datetime\n"],"id":"22e8483b"},{"cell_type":"code","source":["dt_first = datetime.datetime.now()"],"metadata":{"id":"ENmHdWJlxFAl","executionInfo":{"status":"ok","timestamp":1672565026257,"user_tz":-540,"elapsed":16,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}}},"id":"ENmHdWJlxFAl","execution_count":2,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"L5t0COp0WIku"},"source":[],"id":"L5t0COp0WIku"},{"cell_type":"code","execution_count":3,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":46474,"status":"ok","timestamp":1672565072715,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"GeQZ95GFWdcT","outputId":"e56c63ab-7870-43d7-bd13-551f910a2f60"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"],"id":"GeQZ95GFWdcT"},{"cell_type":"code","execution_count":4,"metadata":{"executionInfo":{"elapsed":10820,"status":"ok","timestamp":1672565083513,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"15cf9078"},"outputs":[],"source":["#CSVの表示\n","df = pd.read_csv(r'drive/My Drive/修論/CSV/0927.csv', encoding ='utf_8')\n"],"id":"15cf9078"},{"cell_type":"code","execution_count":5,"metadata":{"executionInfo":{"elapsed":773,"status":"ok","timestamp":1672565084274,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"d838f1c8"},"outputs":[],"source":["df_drop = df.drop(columns= [ 'state', 'timestamp'])\n","df_drop = df_drop.query('type == 1').reset_index()\n","df_dropforTime =  df.drop(columns= [  'state'])\n","df_dropforTime = df_dropforTime.query('type == 1')\n"],"id":"d838f1c8"},{"cell_type":"code","execution_count":6,"metadata":{"id":"676f9bb0","executionInfo":{"status":"ok","timestamp":1672565084274,"user_tz":-540,"elapsed":17,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}}},"outputs":[],"source":["#分散の計算XY軸\n","df_drop[\"Distance\"] = np.nan\n","df_drop[\"Time\"] = np.nan\n","df_drop[\"idsub\"] = np.nan\n","df_drop[\"Posture\"] = np.nan\n"],"id":"676f9bb0"},{"cell_type":"code","execution_count":7,"metadata":{"executionInfo":{"elapsed":1982,"status":"ok","timestamp":1672565086240,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"LxUsfECB23Wp"},"outputs":[],"source":["df_time = df_dropforTime.groupby('id').timestamp.agg(['min', 'max']).reset_index()\n","\n","df_time['max'] = pd.to_datetime(df_time[\"max\"])\n","df_time['min'] = pd.to_datetime(df_time[\"min\"])\n","df_time['IDtime'] = df_time['max'] - df_time['min']\n","df_time['IDtime'] = df_time['IDtime'].dt.total_seconds()\n"],"id":"LxUsfECB23Wp"},{"cell_type":"code","execution_count":8,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":13,"status":"ok","timestamp":1672565086241,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"7TK2LV7k8B2G","outputId":"03c085cd-6677-46d4-925a-72e32bcdf3d5"},"outputs":[{"output_type":"stream","name":"stdout","text":["      id                     min                     max    IDtime\n","0      0 2022-09-27 08:00:00.616 2022-09-27 08:19:50.413  1189.797\n","1      1 2022-09-27 08:00:03.416 2022-09-27 08:01:10.416    67.000\n","2      2 2022-09-27 08:07:50.015 2022-09-27 08:11:32.415   222.400\n","3      3 2022-09-27 08:12:07.214 2022-09-27 10:02:21.595  6614.381\n","4      4 2022-09-27 08:17:11.214 2022-09-27 09:30:21.000  4389.786\n","..   ...                     ...                     ...       ...\n","685  685 2022-09-27 19:45:31.505 2022-09-27 19:46:43.905    72.400\n","686  686 2022-09-27 19:47:17.705 2022-09-27 19:56:29.503   551.798\n","687  687 2022-09-27 19:47:18.305 2022-09-27 19:49:06.504   108.199\n","688  688 2022-09-27 19:48:47.305 2022-09-27 19:59:59.703   672.398\n","690  690 2022-09-27 19:56:28.904 2022-09-27 19:59:59.703   210.799\n","\n","[569 rows x 4 columns]\n","id        122\n","min       122\n","max       122\n","IDtime    122\n","dtype: int64\n","[0, 1, 2, 3, 4, 5, 6, 7, 8, 10, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 44, 45, 46, 48, 49, 50, 55, 56, 57, 58, 59, 60, 61, 62, 64, 65, 66, 67, 68, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 139, 140, 141, 142, 143, 144, 145, 147, 148, 150, 151, 152, 153, 154, 155, 156, 157, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 181, 183, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 206, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 253, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 269, 270, 271, 274, 275, 276, 277, 278, 279, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 312, 313, 314, 315, 316, 318, 320, 321, 322, 323, 325, 326, 327, 328, 329, 330, 331, 333, 334, 335, 336, 337, 338, 339, 340, 341, 343, 345, 348, 349, 350, 352, 353, 354, 355, 356, 357, 358, 360, 361, 363, 364, 365, 366, 367, 368, 369, 372, 374, 375, 376, 377, 378, 379, 384, 388, 392, 393, 394, 395, 398, 399, 400, 405, 407, 409, 410, 411, 412, 413, 414, 415, 416, 417, 418, 419, 420, 421, 422, 423, 424, 425, 426, 427, 428, 429, 430, 431, 432, 433, 434, 435, 436, 437, 440, 442, 443, 444, 445, 446, 447, 448, 449, 451, 452, 454, 455, 456, 458, 459, 460, 461, 462, 464, 465, 466, 467, 468, 469, 470, 471, 472, 473, 475, 476, 477, 478, 479, 484, 486, 487, 489, 491, 492, 493, 494, 495, 496, 497, 498, 499, 500, 501, 502, 503, 504, 505, 506, 507, 508, 509, 511, 512, 513, 514, 515, 516, 517, 518, 519, 520, 523, 524, 526, 527, 528, 529, 530, 531, 532, 533, 534, 535, 536, 537, 538, 539, 540, 541, 542, 544, 545, 546, 547, 548, 549, 550, 551, 552, 553, 554, 555, 556, 557, 558, 559, 560, 561, 562, 563, 564, 566, 567, 568, 569, 570, 571, 572, 573, 574, 575, 576, 577, 578, 579, 580, 581, 582, 583, 584, 585, 586, 587, 588, 589, 590, 591, 592, 593, 594, 595, 596, 598, 599, 600, 602, 603, 604, 605, 606, 607, 608, 609, 611, 612, 613, 614, 615, 616, 617, 618, 620, 621, 622, 624, 653, 654, 655, 656, 657, 658, 659, 660, 661, 662, 663, 664, 665, 666, 667, 668, 669, 670, 671, 672, 673, 674, 675, 676, 677, 679, 680, 681, 682, 683, 684, 685, 686, 687, 688, 690]\n"]}],"source":["#60秒より多いidをリスト化　単位は秒\n","print(df_time.query('IDtime > 60'))\n","print(df_time.query('IDtime <= 60').count())\n","df_60 = df_time.query('IDtime > 60')\n","df_60_list = df_60['id'].values.tolist()\n","print(df_60_list)"],"id":"7TK2LV7k8B2G"},{"cell_type":"code","source":["#リストのidをquery\n","df_60sec = df_60.query('id in @df_60_list')\n","df_drop = df_drop.query('id in @df_60_list').reset_index(drop=True)\n","df_dropforTime = df_dropforTime.query('id in @df_60_list').reset_index(drop=True)\n","\n"],"metadata":{"id":"9Hj1oULk_7zJ","executionInfo":{"status":"ok","timestamp":1672565087606,"user_tz":-540,"elapsed":967,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}}},"id":"9Hj1oULk_7zJ","execution_count":9,"outputs":[]},{"cell_type":"code","execution_count":10,"metadata":{"executionInfo":{"elapsed":4957,"status":"ok","timestamp":1672565092554,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"1b30293a"},"outputs":[],"source":["#前後6秒間での分散\n","\n","df_6sec = df_drop.groupby('id').diff(periods =1, axis = 0).reset_index(drop=True)\n"],"id":"1b30293a"},{"cell_type":"code","execution_count":11,"metadata":{"id":"ea5febfe","executionInfo":{"status":"ok","timestamp":1672565092555,"user_tz":-540,"elapsed":24,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}}},"outputs":[],"source":["def mysqrt(arg: int):\n","  v = x = arg\n","  n = 10\n","\n","  for i in range(1, n):\n","      x = x - (x * x - v) / (2.0 * x)\n","\n","  # print(x)\n","  return x"],"id":"ea5febfe"},{"cell_type":"code","execution_count":12,"metadata":{"executionInfo":{"elapsed":1093,"status":"ok","timestamp":1672565093625,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"dbcdcfc4"},"outputs":[],"source":["#分散の計算√(X+Y)input\n","df_6sec[\"Distance\"] = mysqrt(df_6sec[\"x_pt\"]**2 + df_6sec[\"y_pt\"]**2)\n","\n"],"id":"dbcdcfc4"},{"cell_type":"code","execution_count":13,"metadata":{"executionInfo":{"elapsed":642,"status":"ok","timestamp":1672565094256,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"9f598933"},"outputs":[],"source":["df_drop[\"timestamp\"] = pd.to_datetime(df_dropforTime[\"timestamp\"])\n","df_drop[\"timestamp\"] = df_drop[\"timestamp\"].dt.floor('H')\n"],"id":"9f598933"},{"cell_type":"code","execution_count":14,"metadata":{"executionInfo":{"elapsed":421,"status":"ok","timestamp":1672565094669,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"ba471ff6"},"outputs":[],"source":["df_dropTime = df_dropforTime.reset_index()\n","\n"],"id":"ba471ff6"},{"cell_type":"code","execution_count":15,"metadata":{"executionInfo":{"elapsed":4674,"status":"ok","timestamp":1672565099334,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"4e064d33"},"outputs":[],"source":["df_6sec[\"Time\"] = df_dropTime[\"timestamp\"]\n","df_6sec[\"idsub\"] = df_dropTime[\"id\"]\n","\n","df_loop = df_6sec.sort_values(['idsub', 'Time']).reset_index(drop=True)\n"],"id":"4e064d33"},{"cell_type":"code","execution_count":16,"metadata":{"executionInfo":{"elapsed":4294,"status":"ok","timestamp":1672565103619,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"01f1b74e"},"outputs":[],"source":["df_drop = df_drop.sort_values(['id','level_0']).reset_index(drop=True)\n"],"id":"01f1b74e"},{"cell_type":"code","execution_count":17,"metadata":{"executionInfo":{"elapsed":25,"status":"ok","timestamp":1672565103620,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"9e34f570"},"outputs":[],"source":["#分散の計算XY軸\n","df_drop[\"Variance\"] = np.nan\n","df_drop[\"Time\"] = np.nan\n","df_drop[\"TimeDifferent\"] = np.nan"],"id":"9e34f570"},{"cell_type":"code","execution_count":18,"metadata":{"executionInfo":{"elapsed":5776,"status":"ok","timestamp":1672565109371,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"41f94397"},"outputs":[],"source":["#前後6秒間での分散\n","\n","df_6sec = df_drop.groupby(\"id\").rolling(61, center = True, min_periods=1).var().reset_index()\n"],"id":"41f94397"},{"cell_type":"code","execution_count":19,"metadata":{"executionInfo":{"elapsed":679,"status":"ok","timestamp":1672565110034,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"649979a8"},"outputs":[],"source":["#分散の計算√(X+Y)input\n","df_6sec[\"Variance\"] = mysqrt(df_6sec[\"x_pt\"] + df_6sec[\"y_pt\"])\n","\n"],"id":"649979a8"},{"cell_type":"code","execution_count":20,"metadata":{"executionInfo":{"elapsed":7233,"status":"ok","timestamp":1672565117258,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"49724c3d"},"outputs":[],"source":["df_dropTime = df_drop.sort_values(['index']).reset_index(drop=True)\n","\n","df_time_diff = df_dropforTime.sort_values(['id', 'timestamp'])\n","df_time_diff[\"timestamp\"] = pd.to_datetime(df_time_diff[\"timestamp\"])\n","df_time_diff = df_time_diff.groupby('id').diff(periods =1, axis = 0).reset_index()\n","df_6sec['TimeDifferent'] = df_time_diff['timestamp']"],"id":"49724c3d"},{"cell_type":"code","execution_count":21,"metadata":{"executionInfo":{"elapsed":25,"status":"ok","timestamp":1672565117261,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"a7a9a82f"},"outputs":[],"source":["\n","df_6sec[\"Time\"] = df_dropTime[\"timestamp\"]\n","\n"],"id":"a7a9a82f"},{"cell_type":"code","execution_count":22,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":430,"status":"ok","timestamp":1672565117667,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"209cf314","outputId":"75f8af63-afaa-4957-870d-573d982489ca"},"outputs":[{"output_type":"stream","name":"stdout","text":["3884603\n","308313\n"]}],"source":["df_6sec.loc[df_6sec[\"Variance\"] < 1600 , \"Posture\"] = int(0) #座位\n","df_6sec.loc[df_6sec[\"Variance\"] >= 1600 , \"Posture\"] = int(1) #立位 他のとは違い入れ替えてるので注意\n","\n","print((df_6sec['Posture'] == 0).sum()) #座位\n","print((df_6sec['Posture'] == 1).sum()) #歩行"],"id":"209cf314"},{"cell_type":"code","execution_count":23,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":538,"status":"ok","timestamp":1672565118193,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"cvKmn4_drRW5","outputId":"235f72af-0bc5-43ca-9e8b-0b6e483545c8"},"outputs":[{"output_type":"stream","name":"stdout","text":["1268230791.1420314\n","65922348.06730632\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.8/dist-packages/pandas/core/indexing.py:1817: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame.\n","Try using .loc[row_indexer,col_indexer] = value instead\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  self._setitem_single_column(loc, value, pi)\n"]}],"source":["df_6sec = df_6sec.drop(columns= ['level_0', 'level_1', 'index'])\n","df_loop = df_loop.drop(columns= ['level_0', 'index'])\n","df_loop['Posture'] = df_6sec['Posture']\n","df_loop['TimeDifferent'] = df_6sec['TimeDifferent']\n","df_loop['TimeDifferent'] = df_loop['TimeDifferent'].dt.total_seconds()\n","\n","\n","#連続歩行活動数用 5秒以上時間が経ってたら座位に変更\n","df_c_count = df_loop.query('Posture ==1')\n","df_c_count.loc[df_c_count[\"TimeDifferent\"] >5  , \"Posture\"] = int(0)\n","\n","#歩行距離の再計算\n","df_loop = df_loop.query('Posture == 1')\n","\n","df_one_hour =df_loop\n","\n","print(df_loop['Distance'].sum())\n","df_loop = df_loop.query('TimeDifferent < 5')\n","print(df_loop['Distance'].sum())\n","\n","df_one_hourD =df_loop"],"id":"cvKmn4_drRW5"},{"cell_type":"code","execution_count":23,"metadata":{"id":"adffbc02","executionInfo":{"status":"ok","timestamp":1672565118193,"user_tz":-540,"elapsed":15,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}}},"outputs":[],"source":[],"id":"adffbc02"},{"cell_type":"code","execution_count":24,"metadata":{"id":"6d6a3aef","scrolled":false,"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1672565118480,"user_tz":-540,"elapsed":302,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}},"outputId":"01b968a1-4153-4372-ec76-f9bfaa1f14d9"},"outputs":[{"output_type":"stream","name":"stderr","text":["<ipython-input-24-7afbb7c2214b>:6: UserWarning: Boolean Series key will be reindexed to match DataFrame index.\n","  df_Name = df_loop[df_c_count[\"Posture\"] != df_c_count.groupby('idsub')[\"Posture\"].shift(1)]\n"]}],"source":["#歩行活動数を計算\n","\n","df_SeatCount = np.bincount((df_c_count[\"Posture\"] != df_c_count.groupby('idsub')[\"Posture\"].shift()).cumsum())[1:]\n","\n","\n","df_Name = df_loop[df_c_count[\"Posture\"] != df_c_count.groupby('idsub')[\"Posture\"].shift(1)]\n"],"id":"6d6a3aef"},{"cell_type":"code","execution_count":25,"metadata":{"id":"9e5d2039","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1672565118480,"user_tz":-540,"elapsed":26,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}},"outputId":"10e6b242-6dec-4b9c-b210-1ab0a7823dce"},"outputs":[{"output_type":"stream","name":"stdout","text":["        index  Posture  Count\n","0        4201      1.0    101\n","1        4509      1.0    118\n","2        4709      1.0     81\n","3        5123      1.0      1\n","4        5131      1.0    183\n","...       ...      ...    ...\n","5349  4188741      1.0     18\n","5350  4189587      1.0      1\n","5351  4189589      1.0      2\n","5352  4189645      1.0      1\n","5353  4189660      1.0     25\n","\n","[5354 rows x 3 columns]\n"]}],"source":["CountToArray = pd.Series(df_SeatCount)\n","\n","df_Name_r = df_Name['Posture'].reset_index()\n","df_Name_r[\"Count\"] = np.nan\n","df_Name_r[\"Count\"] = CountToArray\n","\n","#歩行運動数\n","print(df_Name_r.query('Posture == 1'))"],"id":"9e5d2039"},{"cell_type":"code","source":["#一時間の分析"],"metadata":{"id":"EeN_2uyvkFie","executionInfo":{"status":"ok","timestamp":1672565118481,"user_tz":-540,"elapsed":25,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}}},"id":"EeN_2uyvkFie","execution_count":26,"outputs":[]},{"cell_type":"code","source":["#歩行時間(立位フレーム数)\n","df_6sec = df_6sec.dropna(subset=['Posture'])\n","df_6secA = df_6sec.query('Posture == 0')\n","\n","df_6secB = df_6sec.query('Posture == 1')\n","\n","\n","with open('drive/My Drive/修論/pandas書き出し/0927座位フレーム_一時間.csv', 'w', encoding = 'utf-8-sig') as f:\n","  df_6secA.groupby('Time').count().to_csv(f)\n","!cat /drive/My Drive/修論/pandas書き出し/0927座位フレーム_一時間.csv\n","\n","with open('drive/My Drive/修論/pandas書き出し/0927歩行フレーム_一時間.csv', 'w', encoding = 'utf-8-sig') as f:\n","  df_6secB.groupby('Time').count().to_csv(f)\n","!cat /drive/My Drive/修論/pandas書き出し/0927歩行フレーム_一時間.csv"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"k45KvLtIhN9k","executionInfo":{"status":"ok","timestamp":1672565120063,"user_tz":-540,"elapsed":1607,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}},"outputId":"a4b9dd94-8dd0-4721-f5e9-3b70098fd836"},"id":"k45KvLtIhN9k","execution_count":27,"outputs":[{"output_type":"stream","name":"stdout","text":["cat: /drive/My: No such file or directory\n","cat: Drive/修論/pandas書き出し/0927座位フレーム_一時間.csv: No such file or directory\n","cat: /drive/My: No such file or directory\n","cat: Drive/修論/pandas書き出し/0927歩行フレーム_一時間.csv: No such file or directory\n"]}]},{"cell_type":"code","execution_count":28,"metadata":{"id":"ca4c3486","executionInfo":{"status":"ok","timestamp":1672565120915,"user_tz":-540,"elapsed":597,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"95340785-f094-4c82-b83c-60a8e627eca1"},"outputs":[{"output_type":"stream","name":"stderr","text":["<ipython-input-28-fb454b5a2a8b>:4: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame.\n","Try using .loc[row_indexer,col_indexer] = value instead\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  df_one_hourD['Hour'] = df_one_hourD['Time']\n","<ipython-input-28-fb454b5a2a8b>:6: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame.\n","Try using .loc[row_indexer,col_indexer] = value instead\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  df_one_hourD['Hour'] = pd.to_datetime(df_one_hourD[\"Hour\"])\n","<ipython-input-28-fb454b5a2a8b>:7: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame.\n","Try using .loc[row_indexer,col_indexer] = value instead\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  df_one_hourD['Hour'] = df_one_hourD['Hour'].dt.floor('H')\n"]},{"output_type":"stream","name":"stdout","text":["cat: /drive/My: No such file or directory\n","cat: Drive/修論/pandas書き出し/0927歩行距離_一時間.csv: No such file or directory\n"]}],"source":["#一時間ごと\n","\n","\n","df_one_hourD['Hour'] = df_one_hourD['Time']\n","\n","df_one_hourD['Hour'] = pd.to_datetime(df_one_hourD[\"Hour\"])\n","df_one_hourD['Hour'] = df_one_hourD['Hour'].dt.floor('H')\n","df_one_distance = df_one_hourD.groupby('Hour').sum()\n","with open('drive/My Drive/修論/pandas書き出し/0927歩行距離_一時間.csv', 'w', encoding = 'utf-8-sig') as f:\n","  df_one_distance.to_csv(f)\n","!cat /drive/My Drive/修論/pandas書き出し/0927歩行距離_一時間.csv\n"],"id":"ca4c3486"},{"cell_type":"code","source":["CountToArray = pd.Series(df_SeatCount)\n","print(CountToArray)\n","df_Name_r = df_Name[['Posture','Time']].reset_index()\n","df_Name_r[\"Count\"] = np.nan\n","df_Name_r[\"Count\"] = CountToArray\n","df_Name_r = df_Name_r.set_index('index')\n","\n","df_Name_r['time'] = df_c_count['Time']\n","df_Name_r['time'] = pd.to_datetime(df_Name_r['time'])\n","df_Name_r['time'] = df_Name_r['time'].dt.floor('H')\n","\n","#歩行運動数\n","\n","with open('drive/My Drive/修論/pandas書き出し/0927歩行活動数_一時間.csv', 'w', encoding = 'utf-8-sig') as f:\n","  df_Name_r.groupby('time').count().to_csv(f)\n","!cat /drive/My Drive/修論/pandas書き出し/0927歩行活動数_一時間.csv\n","\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"bwGLsYW_jYUv","executionInfo":{"status":"ok","timestamp":1672565121189,"user_tz":-540,"elapsed":289,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}},"outputId":"3c053a64-4e6d-496e-f89c-6a6218c45d62"},"id":"bwGLsYW_jYUv","execution_count":29,"outputs":[{"output_type":"stream","name":"stdout","text":["0        101\n","1        118\n","2         81\n","3          1\n","4        183\n","        ... \n","11235     14\n","11236      1\n","11237     84\n","11238    298\n","11239     85\n","Length: 11240, dtype: int64\n","cat: /drive/My: No such file or directory\n","cat: Drive/修論/pandas書き出し/0927歩行活動数_一時間.csv: No such file or directory\n"]}]},{"cell_type":"code","source":["dt_last = datetime.datetime.now()\n","\n","print(dt_last - dt_first)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"wGs5t9Ygwu5b","executionInfo":{"status":"ok","timestamp":1672565121190,"user_tz":-540,"elapsed":18,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}},"outputId":"3021010e-1f7f-4533-fd2e-38d28c922631"},"id":"wGs5t9Ygwu5b","execution_count":30,"outputs":[{"output_type":"stream","name":"stdout","text":["0:01:35.249948\n"]}]},{"cell_type":"code","execution_count":31,"metadata":{"id":"20nZsDZ_-FEK","executionInfo":{"status":"ok","timestamp":1672565121190,"user_tz":-540,"elapsed":16,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}}},"outputs":[],"source":["#postureを列に入れる→→df_loopを他のdf_newidに変換\n","#time_distance > 5の場合はposture0に変換に変換\n","#postureが同じ場合に新idにする\n","#query(\"posture = 1\")\n","#df_newid.groupby(\"id\").nunique()"],"id":"20nZsDZ_-FEK"}],"metadata":{"colab":{"provenance":[{"file_id":"1InrDMPqXKyRP13eDwuht-ugWcyRRwxk9","timestamp":1672500631969},{"file_id":"1r9M0JfBkoAnLyYiWkJTRsu1-jzTfNJsn","timestamp":1672117185579},{"file_id":"1ZqfOhVWb9BghmSVdYTW6Uh_W6bmaVN40","timestamp":1672061471042},{"file_id":"1dVKjzrT6SoqydJoKkGKfXKe0-Oq5Jk-Y","timestamp":1671505341222}],"history_visible":true},"kernelspec":{"display_name":"Python 3 (ipykernel)","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.13"}},"nbformat":4,"nbformat_minor":5}