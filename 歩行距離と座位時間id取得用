{"cells":[{"cell_type":"code","execution_count":1,"metadata":{"id":"22e8483b","executionInfo":{"status":"ok","timestamp":1672557228812,"user_tz":-540,"elapsed":309,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}}},"outputs":[],"source":["import pandas as pd\n","import numpy as np\n","import math \n","import io\n","import datetime\n"],"id":"22e8483b"},{"cell_type":"code","source":["dt_first = datetime.datetime.now()"],"metadata":{"id":"ENmHdWJlxFAl","executionInfo":{"status":"ok","timestamp":1672557228813,"user_tz":-540,"elapsed":13,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}}},"id":"ENmHdWJlxFAl","execution_count":2,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"L5t0COp0WIku"},"source":[],"id":"L5t0COp0WIku"},{"cell_type":"code","execution_count":3,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2224,"status":"ok","timestamp":1672557231024,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"GeQZ95GFWdcT","outputId":"86345420-36b2-470c-e1ef-58c7f1dc0606"},"outputs":[{"output_type":"stream","name":"stdout","text":["Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(\"/content/drive\", force_remount=True).\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"],"id":"GeQZ95GFWdcT"},{"cell_type":"code","execution_count":4,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":10425,"status":"ok","timestamp":1672557241440,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"15cf9078","outputId":"0cedf80b-f676-414a-edfe-b1dd62f3031c"},"outputs":[{"output_type":"stream","name":"stdout","text":["          index                timestamp   id          x_pt         y_pt  \\\n","0             1  2022-10-28 08:00:03.761    1 -16024.629593 -1379.431963   \n","1             2  2022-10-28 08:00:03.960    1 -16016.740799 -1463.277221   \n","2             3  2022-10-28 08:00:11.961    2 -16017.063141 -1463.306785   \n","3             4  2022-10-28 08:00:12.160    2 -16021.707535 -1412.992835   \n","4             5  2022-10-28 08:00:15.961    2 -15986.474037  -995.668352   \n","...         ...                      ...  ...           ...          ...   \n","4032863  207485  2022-10-28 19:59:59.825  398 -11175.394058 -2192.237854   \n","4032864  207485  2022-10-28 19:59:59.825  413  13907.304764 -1810.075045   \n","4032865  207485  2022-10-28 19:59:59.825  417  17106.275558  3750.520706   \n","4032866  207485  2022-10-28 19:59:59.825  414  13922.131538 -2986.966610   \n","4032867  207485  2022-10-28 19:59:59.825  367    586.791575  7683.887959   \n","\n","         type  state  \n","0           0      0  \n","1           0      0  \n","2           0      0  \n","3           0      0  \n","4           0      0  \n","...       ...    ...  \n","4032863     1      3  \n","4032864     1      3  \n","4032865     1      3  \n","4032866     1      3  \n","4032867     1      2  \n","\n","[4032868 rows x 7 columns]\n"]}],"source":["#CSVの表示\n","df = pd.read_csv(r'drive/My Drive/修論/CSV/1028.csv', encoding ='utf_8')\n","\n","print(df)"],"id":"15cf9078"},{"cell_type":"code","execution_count":5,"metadata":{"executionInfo":{"elapsed":886,"status":"ok","timestamp":1672557242315,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"d838f1c8"},"outputs":[],"source":["df_drop = df.drop(columns= [ 'state', 'timestamp'])\n","df_drop = df_drop.query('type == 1').reset_index()\n","df_dropforTime =  df.drop(columns= [  'state'])\n","df_dropforTime = df_dropforTime.query('type == 1')\n"],"id":"d838f1c8"},{"cell_type":"code","execution_count":6,"metadata":{"id":"676f9bb0","executionInfo":{"status":"ok","timestamp":1672557242318,"user_tz":-540,"elapsed":18,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}}},"outputs":[],"source":["#分散の計算XY軸\n","df_drop[\"Distance\"] = np.nan\n","df_drop[\"Time\"] = np.nan\n","df_drop[\"idsub\"] = np.nan\n","df_drop[\"Posture\"] = np.nan\n"],"id":"676f9bb0"},{"cell_type":"code","execution_count":7,"metadata":{"executionInfo":{"elapsed":2111,"status":"ok","timestamp":1672557244412,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"LxUsfECB23Wp"},"outputs":[],"source":["df_time = df_dropforTime.groupby('id').timestamp.agg(['min', 'max']).reset_index()\n","\n","df_time['max'] = pd.to_datetime(df_time[\"max\"])\n","df_time['min'] = pd.to_datetime(df_time[\"min\"])\n","df_time['IDtime'] = df_time['max'] - df_time['min']\n","df_time['IDtime'] = df_time['IDtime'].dt.total_seconds()\n"],"id":"LxUsfECB23Wp"},{"cell_type":"code","execution_count":8,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":17,"status":"ok","timestamp":1672557244413,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"7TK2LV7k8B2G","outputId":"43984ece-eedf-4596-eec6-3d45585509d2"},"outputs":[{"output_type":"stream","name":"stdout","text":["      id                     min                     max     IDtime\n","0      0 2022-10-28 08:00:48.961 2022-10-28 12:46:07.912  17118.951\n","1      1 2022-10-28 08:13:21.757 2022-10-28 09:29:15.344   4553.587\n","2      2 2022-10-28 08:19:18.157 2022-10-28 08:48:49.151   1770.994\n","3      3 2022-10-28 08:23:33.556 2022-10-28 08:27:51.555    257.999\n","4      4 2022-10-28 08:32:35.554 2022-10-28 19:14:41.232  38525.678\n","..   ...                     ...                     ...        ...\n","413  413 2022-10-28 19:16:31.232 2022-10-28 19:59:59.825   2608.593\n","414  414 2022-10-28 19:17:10.432 2022-10-28 19:59:59.825   2569.393\n","417  417 2022-10-28 19:19:51.631 2022-10-28 19:59:59.825   2408.194\n","418  418 2022-10-28 19:24:33.030 2022-10-28 19:36:35.829    722.799\n","419  419 2022-10-28 19:47:57.627 2022-10-28 19:58:01.625    603.998\n","\n","[364 rows x 4 columns]\n","id        56\n","min       56\n","max       56\n","IDtime    56\n","dtype: int64\n","[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 27, 28, 30, 31, 32, 33, 34, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 61, 62, 63, 65, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 80, 81, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 128, 129, 130, 131, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 165, 166, 167, 168, 170, 171, 173, 180, 181, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 212, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 227, 228, 229, 230, 231, 232, 233, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 294, 295, 296, 297, 298, 299, 300, 301, 302, 303, 307, 308, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332, 336, 337, 338, 339, 340, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 362, 363, 364, 365, 366, 367, 368, 369, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379, 380, 383, 384, 385, 386, 387, 389, 391, 392, 393, 394, 395, 396, 397, 398, 399, 400, 401, 402, 403, 404, 406, 407, 408, 409, 411, 412, 413, 414, 417, 418, 419]\n"]}],"source":["#60秒より多いidをリスト化\n","print(df_time.query('IDtime > 60'))\n","print(df_time.query('IDtime <= 60').count())\n","df_60 = df_time.query('IDtime > 60')\n","df_60_list = df_60['id'].values.tolist()\n","print(df_60_list)"],"id":"7TK2LV7k8B2G"},{"cell_type":"code","source":["#リストのidをquery\n","df_60sec = df_60.query('id in @df_60_list')\n","df_drop = df_drop.query('id in @df_60_list').reset_index(drop=True)\n","df_dropforTime = df_dropforTime.query('id in @df_60_list').reset_index(drop=True)\n","print(df_drop)\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"9Hj1oULk_7zJ","executionInfo":{"status":"ok","timestamp":1672557245480,"user_tz":-540,"elapsed":1082,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}},"outputId":"35c19e0a-51a8-477c-c16c-e0753e89c33c"},"id":"9Hj1oULk_7zJ","execution_count":9,"outputs":[{"output_type":"stream","name":"stdout","text":["         level_0   index   id          x_pt         y_pt  type  Distance  \\\n","0             15      15    0  16534.543991  3428.321123     1       NaN   \n","1             17      16    0  16560.508728  3409.677267     1       NaN   \n","2             19      17    0  16569.574356  3396.122694     1       NaN   \n","3             21      18    0  16546.463013  3397.356510     1       NaN   \n","4             23      19    0  16541.519165  3408.698559     1       NaN   \n","...          ...     ...  ...           ...          ...   ...       ...   \n","2506707  4032863  207485  398 -11175.394058 -2192.237854     1       NaN   \n","2506708  4032864  207485  413  13907.304764 -1810.075045     1       NaN   \n","2506709  4032865  207485  417  17106.275558  3750.520706     1       NaN   \n","2506710  4032866  207485  414  13922.131538 -2986.966610     1       NaN   \n","2506711  4032867  207485  367    586.791575  7683.887959     1       NaN   \n","\n","         Time  idsub  Posture  \n","0         NaN    NaN      NaN  \n","1         NaN    NaN      NaN  \n","2         NaN    NaN      NaN  \n","3         NaN    NaN      NaN  \n","4         NaN    NaN      NaN  \n","...       ...    ...      ...  \n","2506707   NaN    NaN      NaN  \n","2506708   NaN    NaN      NaN  \n","2506709   NaN    NaN      NaN  \n","2506710   NaN    NaN      NaN  \n","2506711   NaN    NaN      NaN  \n","\n","[2506712 rows x 10 columns]\n"]}]},{"cell_type":"code","execution_count":10,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2720,"status":"ok","timestamp":1672557248189,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"1b30293a","outputId":"421a8dc7-7ecb-4e3a-f9d2-6a1a0cdc1497"},"outputs":[{"output_type":"stream","name":"stdout","text":["         level_0   index   id          x_pt         y_pt  type  Distance  \\\n","0             15      15    0  16534.543991  3428.321123     1       NaN   \n","1             17      16    0  16560.508728  3409.677267     1       NaN   \n","2             19      17    0  16569.574356  3396.122694     1       NaN   \n","3             21      18    0  16546.463013  3397.356510     1       NaN   \n","4             23      19    0  16541.519165  3408.698559     1       NaN   \n","...          ...     ...  ...           ...          ...   ...       ...   \n","2506707  4032863  207485  398 -11175.394058 -2192.237854     1       NaN   \n","2506708  4032864  207485  413  13907.304764 -1810.075045     1       NaN   \n","2506709  4032865  207485  417  17106.275558  3750.520706     1       NaN   \n","2506710  4032866  207485  414  13922.131538 -2986.966610     1       NaN   \n","2506711  4032867  207485  367    586.791575  7683.887959     1       NaN   \n","\n","         Time  idsub  Posture  \n","0         NaN    NaN      NaN  \n","1         NaN    NaN      NaN  \n","2         NaN    NaN      NaN  \n","3         NaN    NaN      NaN  \n","4         NaN    NaN      NaN  \n","...       ...    ...      ...  \n","2506707   NaN    NaN      NaN  \n","2506708   NaN    NaN      NaN  \n","2506709   NaN    NaN      NaN  \n","2506710   NaN    NaN      NaN  \n","2506711   NaN    NaN      NaN  \n","\n","[2506712 rows x 10 columns]\n","         level_0  index       x_pt       y_pt  type  Distance  Time  idsub  \\\n","0            NaN    NaN        NaN        NaN   NaN       NaN   NaN    NaN   \n","1            2.0    1.0  25.964737 -18.643856   0.0       NaN   NaN    NaN   \n","2            2.0    1.0   9.065628 -13.554573   0.0       NaN   NaN    NaN   \n","3            2.0    1.0 -23.111343   1.233816   0.0       NaN   NaN    NaN   \n","4            2.0    1.0  -4.943848  11.342049   0.0       NaN   NaN    NaN   \n","...          ...    ...        ...        ...   ...       ...   ...    ...   \n","2506707     11.0    1.0   0.000000   0.000000   0.0       NaN   NaN    NaN   \n","2506708     11.0    1.0   0.000000   0.000000   0.0       NaN   NaN    NaN   \n","2506709     11.0    1.0   0.000000   0.000000   0.0       NaN   NaN    NaN   \n","2506710     11.0    1.0   0.000000   0.000000   0.0       NaN   NaN    NaN   \n","2506711     11.0    1.0   5.056679 -33.090114   0.0       NaN   NaN    NaN   \n","\n","         Posture  \n","0            NaN  \n","1            NaN  \n","2            NaN  \n","3            NaN  \n","4            NaN  \n","...          ...  \n","2506707      NaN  \n","2506708      NaN  \n","2506709      NaN  \n","2506710      NaN  \n","2506711      NaN  \n","\n","[2506712 rows x 9 columns]\n"]}],"source":["#前後6秒間での分散\n","print(df_drop)\n","df_6sec = df_drop.groupby('id').diff(periods =1, axis = 0).reset_index(drop=True)\n","\n","print(df_6sec)\n"],"id":"1b30293a"},{"cell_type":"code","execution_count":11,"metadata":{"id":"ea5febfe","executionInfo":{"status":"ok","timestamp":1672557248190,"user_tz":-540,"elapsed":16,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}}},"outputs":[],"source":["def mysqrt(arg: int):\n","  v = x = arg\n","  n = 10\n","\n","  for i in range(1, n):\n","      x = x - (x * x - v) / (2.0 * x)\n","\n","  # print(x)\n","  return x"],"id":"ea5febfe"},{"cell_type":"code","execution_count":12,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":448,"status":"ok","timestamp":1672557248623,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"dbcdcfc4","outputId":"3f848246-de7a-47c3-bf36-d00bc786a72e"},"outputs":[{"output_type":"stream","name":"stdout","text":["         level_0  index       x_pt       y_pt  type   Distance  Time  idsub  \\\n","0            NaN    NaN        NaN        NaN   NaN        NaN   NaN    NaN   \n","1            2.0    1.0  25.964737 -18.643856   0.0  31.964995   NaN    NaN   \n","2            2.0    1.0   9.065628 -13.554573   0.0  16.306810   NaN    NaN   \n","3            2.0    1.0 -23.111343   1.233816   0.0  23.144254   NaN    NaN   \n","4            2.0    1.0  -4.943848  11.342049   0.0  12.372700   NaN    NaN   \n","...          ...    ...        ...        ...   ...        ...   ...    ...   \n","2506707     11.0    1.0   0.000000   0.000000   0.0        NaN   NaN    NaN   \n","2506708     11.0    1.0   0.000000   0.000000   0.0        NaN   NaN    NaN   \n","2506709     11.0    1.0   0.000000   0.000000   0.0        NaN   NaN    NaN   \n","2506710     11.0    1.0   0.000000   0.000000   0.0        NaN   NaN    NaN   \n","2506711     11.0    1.0   5.056679 -33.090114   0.0  33.474253   NaN    NaN   \n","\n","         Posture  \n","0            NaN  \n","1            NaN  \n","2            NaN  \n","3            NaN  \n","4            NaN  \n","...          ...  \n","2506707      NaN  \n","2506708      NaN  \n","2506709      NaN  \n","2506710      NaN  \n","2506711      NaN  \n","\n","[2506712 rows x 9 columns]\n"]}],"source":["#分散の計算√(X+Y)input\n","df_6sec[\"Distance\"] = mysqrt(df_6sec[\"x_pt\"]**2 + df_6sec[\"y_pt\"]**2)\n","\n","\n","print(df_6sec)"],"id":"dbcdcfc4"},{"cell_type":"code","execution_count":13,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":26,"status":"ok","timestamp":1672557249058,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"9f598933","outputId":"f3fbece1-75d0-4b1a-dc8d-3cafd2666578"},"outputs":[{"output_type":"stream","name":"stdout","text":["         level_0   index   id          x_pt         y_pt  type  Distance  \\\n","0             15      15    0  16534.543991  3428.321123     1       NaN   \n","1             17      16    0  16560.508728  3409.677267     1       NaN   \n","2             19      17    0  16569.574356  3396.122694     1       NaN   \n","3             21      18    0  16546.463013  3397.356510     1       NaN   \n","4             23      19    0  16541.519165  3408.698559     1       NaN   \n","...          ...     ...  ...           ...          ...   ...       ...   \n","2506707  4032863  207485  398 -11175.394058 -2192.237854     1       NaN   \n","2506708  4032864  207485  413  13907.304764 -1810.075045     1       NaN   \n","2506709  4032865  207485  417  17106.275558  3750.520706     1       NaN   \n","2506710  4032866  207485  414  13922.131538 -2986.966610     1       NaN   \n","2506711  4032867  207485  367    586.791575  7683.887959     1       NaN   \n","\n","         Time  idsub  Posture           timestamp  \n","0         NaN    NaN      NaN 2022-10-28 08:00:00  \n","1         NaN    NaN      NaN 2022-10-28 08:00:00  \n","2         NaN    NaN      NaN 2022-10-28 08:00:00  \n","3         NaN    NaN      NaN 2022-10-28 08:00:00  \n","4         NaN    NaN      NaN 2022-10-28 08:00:00  \n","...       ...    ...      ...                 ...  \n","2506707   NaN    NaN      NaN 2022-10-28 19:00:00  \n","2506708   NaN    NaN      NaN 2022-10-28 19:00:00  \n","2506709   NaN    NaN      NaN 2022-10-28 19:00:00  \n","2506710   NaN    NaN      NaN 2022-10-28 19:00:00  \n","2506711   NaN    NaN      NaN 2022-10-28 19:00:00  \n","\n","[2506712 rows x 11 columns]\n"]}],"source":["df_drop[\"timestamp\"] = pd.to_datetime(df_dropforTime[\"timestamp\"])\n","df_drop[\"timestamp\"] = df_drop[\"timestamp\"].dt.floor('H')\n","print(df_drop)"],"id":"9f598933"},{"cell_type":"code","execution_count":14,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":26,"status":"ok","timestamp":1672557249059,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"ba471ff6","outputId":"c87bac4f-edd6-4c5a-8868-5c19492d552c"},"outputs":[{"output_type":"stream","name":"stdout","text":["         level_0   index                timestamp   id          x_pt  \\\n","0              0      15  2022-10-28 08:00:48.961    0  16534.543991   \n","1              1      16  2022-10-28 08:00:49.161    0  16560.508728   \n","2              2      17  2022-10-28 08:00:49.360    0  16569.574356   \n","3              3      18  2022-10-28 08:00:49.560    0  16546.463013   \n","4              4      19  2022-10-28 08:00:49.761    0  16541.519165   \n","...          ...     ...                      ...  ...           ...   \n","2506707  2506707  207485  2022-10-28 19:59:59.825  398 -11175.394058   \n","2506708  2506708  207485  2022-10-28 19:59:59.825  413  13907.304764   \n","2506709  2506709  207485  2022-10-28 19:59:59.825  417  17106.275558   \n","2506710  2506710  207485  2022-10-28 19:59:59.825  414  13922.131538   \n","2506711  2506711  207485  2022-10-28 19:59:59.825  367    586.791575   \n","\n","                y_pt  type  \n","0        3428.321123     1  \n","1        3409.677267     1  \n","2        3396.122694     1  \n","3        3397.356510     1  \n","4        3408.698559     1  \n","...              ...   ...  \n","2506707 -2192.237854     1  \n","2506708 -1810.075045     1  \n","2506709  3750.520706     1  \n","2506710 -2986.966610     1  \n","2506711  7683.887959     1  \n","\n","[2506712 rows x 7 columns]\n"]}],"source":["df_dropTime = df_dropforTime.reset_index()\n","print(df_dropTime)\n"],"id":"ba471ff6"},{"cell_type":"code","execution_count":15,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1846,"status":"ok","timestamp":1672557250881,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"4e064d33","outputId":"dc30fee0-c8c6-4c9d-b414-f46c6283afed"},"outputs":[{"output_type":"stream","name":"stdout","text":["         level_0  index       x_pt       y_pt  type   Distance  \\\n","0            NaN    NaN        NaN        NaN   NaN        NaN   \n","1            2.0    1.0  25.964737 -18.643856   0.0  31.964995   \n","2            2.0    1.0   9.065628 -13.554573   0.0  16.306810   \n","3            2.0    1.0 -23.111343   1.233816   0.0  23.144254   \n","4            2.0    1.0  -4.943848  11.342049   0.0  12.372700   \n","...          ...    ...        ...        ...   ...        ...   \n","2506707     11.0    1.0   0.000000   0.000000   0.0        NaN   \n","2506708     11.0    1.0   0.000000   0.000000   0.0        NaN   \n","2506709     11.0    1.0   0.000000   0.000000   0.0        NaN   \n","2506710     11.0    1.0   0.000000   0.000000   0.0        NaN   \n","2506711     11.0    1.0   5.056679 -33.090114   0.0  33.474253   \n","\n","                            Time  idsub  Posture  \n","0        2022-10-28 08:00:48.961      0      NaN  \n","1        2022-10-28 08:00:49.161      0      NaN  \n","2        2022-10-28 08:00:49.360      0      NaN  \n","3        2022-10-28 08:00:49.560      0      NaN  \n","4        2022-10-28 08:00:49.761      0      NaN  \n","...                          ...    ...      ...  \n","2506707  2022-10-28 19:59:59.825    398      NaN  \n","2506708  2022-10-28 19:59:59.825    413      NaN  \n","2506709  2022-10-28 19:59:59.825    417      NaN  \n","2506710  2022-10-28 19:59:59.825    414      NaN  \n","2506711  2022-10-28 19:59:59.825    367      NaN  \n","\n","[2506712 rows x 9 columns]\n"]}],"source":["df_6sec[\"Time\"] = df_dropTime[\"timestamp\"]\n","df_6sec[\"idsub\"] = df_dropTime[\"id\"]\n","print(df_6sec)\n","df_loop = df_6sec.sort_values(['idsub', 'Time']).reset_index(drop=True)\n"],"id":"4e064d33"},{"cell_type":"code","execution_count":16,"metadata":{"executionInfo":{"elapsed":1627,"status":"ok","timestamp":1672557252499,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"01f1b74e"},"outputs":[],"source":["df_drop = df_drop.sort_values(['id','level_0']).reset_index(drop=True)\n"],"id":"01f1b74e"},{"cell_type":"code","execution_count":17,"metadata":{"executionInfo":{"elapsed":16,"status":"ok","timestamp":1672557252499,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"9e34f570"},"outputs":[],"source":["#分散の計算XY軸\n","df_drop[\"Variance\"] = np.nan\n","df_drop[\"Time\"] = np.nan\n","df_drop[\"TimeDifferent\"] = np.nan"],"id":"9e34f570"},{"cell_type":"code","execution_count":18,"metadata":{"executionInfo":{"elapsed":3862,"status":"ok","timestamp":1672557256346,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"41f94397"},"outputs":[],"source":["#前後6秒間での分散\n","\n","df_6sec = df_drop.groupby(\"id\").rolling(61, center = True, min_periods=1).var().reset_index()\n"],"id":"41f94397"},{"cell_type":"code","execution_count":19,"metadata":{"executionInfo":{"elapsed":24,"status":"ok","timestamp":1672557256347,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"649979a8"},"outputs":[],"source":["#分散の計算√(X+Y)input\n","df_6sec[\"Variance\"] = mysqrt(df_6sec[\"x_pt\"] + df_6sec[\"y_pt\"])\n","\n"],"id":"649979a8"},{"cell_type":"code","execution_count":20,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":3011,"status":"ok","timestamp":1672557259334,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"49724c3d","outputId":"6666dc70-018e-452e-dd31-9b1c76a18d51"},"outputs":[{"output_type":"stream","name":"stdout","text":["         level_0   index   id          x_pt         y_pt  type  Distance  \\\n","0             15      15    0  16534.543991  3428.321123     1       NaN   \n","1             17      16    0  16560.508728  3409.677267     1       NaN   \n","2             19      17    0  16569.574356  3396.122694     1       NaN   \n","3             21      18    0  16546.463013  3397.356510     1       NaN   \n","4             23      19    0  16541.519165  3408.698559     1       NaN   \n","...          ...     ...  ...           ...          ...   ...       ...   \n","2506707  4032867  207485  367    586.791575  7683.887959     1       NaN   \n","2506708  4032863  207485  398 -11175.394058 -2192.237854     1       NaN   \n","2506709  4032862  207485  375  17084.712982  3927.820444     1       NaN   \n","2506710  4032866  207485  414  13922.131538 -2986.966610     1       NaN   \n","2506711  4032865  207485  417  17106.275558  3750.520706     1       NaN   \n","\n","         Time  idsub  Posture           timestamp  Variance  TimeDifferent  \n","0         NaN    NaN      NaN 2022-10-28 08:00:00       NaN            NaN  \n","1         NaN    NaN      NaN 2022-10-28 08:00:00       NaN            NaN  \n","2         NaN    NaN      NaN 2022-10-28 08:00:00       NaN            NaN  \n","3         NaN    NaN      NaN 2022-10-28 08:00:00       NaN            NaN  \n","4         NaN    NaN      NaN 2022-10-28 08:00:00       NaN            NaN  \n","...       ...    ...      ...                 ...       ...            ...  \n","2506707   NaN    NaN      NaN 2022-10-28 19:00:00       NaN            NaN  \n","2506708   NaN    NaN      NaN 2022-10-28 19:00:00       NaN            NaN  \n","2506709   NaN    NaN      NaN 2022-10-28 19:00:00       NaN            NaN  \n","2506710   NaN    NaN      NaN 2022-10-28 19:00:00       NaN            NaN  \n","2506711   NaN    NaN      NaN 2022-10-28 19:00:00       NaN            NaN  \n","\n","[2506712 rows x 13 columns]\n"]}],"source":["df_dropTime = df_drop.sort_values(['index']).reset_index(drop=True)\n","print(df_dropTime)\n","df_time_diff = df_dropforTime.sort_values(['id', 'timestamp'])\n","df_time_diff[\"timestamp\"] = pd.to_datetime(df_time_diff[\"timestamp\"])\n","df_time_diff = df_time_diff.groupby('id').diff(periods =1, axis = 0).reset_index()\n","df_6sec['TimeDifferent'] = df_time_diff['timestamp']"],"id":"49724c3d"},{"cell_type":"code","execution_count":21,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":39,"status":"ok","timestamp":1672557259334,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"a7a9a82f","outputId":"880a8e53-8496-4444-c34a-722038613deb"},"outputs":[{"output_type":"stream","name":"stdout","text":["          id  level_1      level_0       index          x_pt          y_pt  \\\n","0          0        0   357.124731   82.666667  1.374143e+04  2.395823e+04   \n","1          0        1   382.834677   88.000000  1.341276e+04  2.388473e+04   \n","2          0        2   408.926136   93.500000  1.356364e+04  2.336657e+04   \n","3          0        3   437.594474   99.166667  1.362851e+04  2.297792e+04   \n","4          0        4   468.773109  105.000000  1.354187e+04  2.252377e+04   \n","...      ...      ...          ...         ...           ...           ...   \n","2506707  419  2506707  7385.222771  105.000000  3.383103e-11  3.480476e-09   \n","2506708  419  2506708  6954.190790   99.166667  3.485621e-11  3.585945e-09   \n","2506709  419  2506709  6530.065375   93.500000  3.594547e-11  3.698005e-09   \n","2506710  419  2506710  6112.467747   88.000000  3.710500e-11  3.817296e-09   \n","2506711  419  2506711  5700.966638   82.666667  3.834183e-11  3.944539e-09   \n","\n","         type  Distance                Time  idsub  Posture    Variance  \\\n","0         0.0       NaN 2022-10-28 08:00:00    NaN      NaN  196.163805   \n","1         0.0       NaN 2022-10-28 08:00:00    NaN      NaN  195.058799   \n","2         0.0       NaN 2022-10-28 08:00:00    NaN      NaN  194.045842   \n","3         0.0       NaN 2022-10-28 08:00:00    NaN      NaN  193.149766   \n","4         0.0       NaN 2022-10-28 08:00:00    NaN      NaN  191.646574   \n","...       ...       ...                 ...    ...      ...         ...   \n","2506707   0.0       NaN 2022-10-28 19:00:00    NaN      NaN    0.001954   \n","2506708   0.0       NaN 2022-10-28 19:00:00    NaN      NaN    0.001954   \n","2506709   0.0       NaN 2022-10-28 19:00:00    NaN      NaN    0.001954   \n","2506710   0.0       NaN 2022-10-28 19:00:00    NaN      NaN    0.001954   \n","2506711   0.0       NaN 2022-10-28 19:00:00    NaN      NaN    0.001954   \n","\n","                 TimeDifferent  \n","0                          NaT  \n","1       0 days 00:00:00.200000  \n","2       0 days 00:00:00.199000  \n","3       0 days 00:00:00.200000  \n","4       0 days 00:00:00.201000  \n","...                        ...  \n","2506707 0 days 00:00:00.200000  \n","2506708 0 days 00:00:00.200000  \n","2506709 0 days 00:00:00.199000  \n","2506710 0 days 00:00:00.201000  \n","2506711 0 days 00:00:00.200000  \n","\n","[2506712 rows x 13 columns]\n"]}],"source":["\n","df_6sec[\"Time\"] = df_dropTime[\"timestamp\"]\n","\n","print(df_6sec)"],"id":"a7a9a82f"},{"cell_type":"code","execution_count":22,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":39,"status":"ok","timestamp":1672557259335,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"209cf314","outputId":"8a111092-2aea-46d1-a5e0-8a9884044b10"},"outputs":[{"output_type":"stream","name":"stdout","text":["2309386\n","194734\n"]}],"source":["df_6sec.loc[df_6sec[\"Variance\"] < 1600 , \"Posture\"] = int(0) #座位\n","df_6sec.loc[df_6sec[\"Variance\"] >= 1600 , \"Posture\"] = int(1) #立位 他のとは違い入れ替えてるので注意\n","\n","print((df_6sec['Posture'] == 0).sum()) #座位\n","print((df_6sec['Posture'] == 1).sum()) #歩行"],"id":"209cf314"},{"cell_type":"code","execution_count":23,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":388,"status":"ok","timestamp":1672557259685,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"},"user_tz":-540},"id":"cvKmn4_drRW5","outputId":"a5405268-79c3-4826-9edf-07c62f5ed7d9"},"outputs":[{"output_type":"stream","name":"stdout","text":["         x_pt  y_pt  type  Distance                     Time  idsub  Posture  \\\n","39889     0.0   0.0   0.0       NaN  2022-10-28 10:35:32.933      0      1.0   \n","39890     0.0   0.0   0.0       NaN  2022-10-28 10:35:33.132      0      1.0   \n","39891     0.0   0.0   0.0       NaN  2022-10-28 10:35:33.333      0      1.0   \n","39892     0.0   0.0   0.0       NaN  2022-10-28 10:35:33.533      0      1.0   \n","39893     0.0   0.0   0.0       NaN  2022-10-28 10:35:33.734      0      1.0   \n","...       ...   ...   ...       ...                      ...    ...      ...   \n","2504074   0.0   0.0   0.0       NaN  2022-10-28 19:48:04.227    419      1.0   \n","2504075   0.0   0.0   0.0       NaN  2022-10-28 19:48:04.427    419      1.0   \n","2504076   0.0   0.0   0.0       NaN  2022-10-28 19:48:04.626    419      1.0   \n","2504077   0.0   0.0   0.0       NaN  2022-10-28 19:48:04.827    419      1.0   \n","2504078   0.0   0.0   0.0       NaN  2022-10-28 19:48:05.027    419      1.0   \n","\n","         TimeDifferent  \n","39889            0.200  \n","39890            0.199  \n","39891            0.201  \n","39892            0.200  \n","39893            0.201  \n","...                ...  \n","2504074          0.201  \n","2504075          0.200  \n","2504076          0.199  \n","2504077          0.201  \n","2504078          0.200  \n","\n","[194734 rows x 8 columns]\n","674525057.6695908\n","42216184.10022601\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.8/dist-packages/pandas/core/indexing.py:1817: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame.\n","Try using .loc[row_indexer,col_indexer] = value instead\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  self._setitem_single_column(loc, value, pi)\n"]}],"source":["df_6sec = df_6sec.drop(columns= ['level_0', 'level_1', 'index'])\n","df_loop = df_loop.drop(columns= ['level_0', 'index'])\n","df_loop['Posture'] = df_6sec['Posture']\n","df_loop['TimeDifferent'] = df_6sec['TimeDifferent']\n","df_loop['TimeDifferent'] = df_loop['TimeDifferent'].dt.total_seconds()\n","\n","\n","#連続歩行活動数用 5秒以上時間が経ってたら座位に変更\n","df_c_count = df_loop.query('Posture ==1')\n","df_c_count.loc[df_c_count[\"TimeDifferent\"] >5  , \"Posture\"] = int(0)\n","\n","#歩行距離の再計算\n","df_loop = df_loop.query('Posture == 1')\n","\n","df_one_hour =df_loop\n","df_unique = df_loop\n","df_IDconfig_5min = df_loop\n","\n","print(df_loop)\n","\n","print(df_loop['Distance'].sum())\n","df_loop = df_loop.query('TimeDifferent < 5')\n","print(df_loop['Distance'].sum())\n","\n","df_one_hourD =df_loop"],"id":"cvKmn4_drRW5"},{"cell_type":"code","execution_count":24,"metadata":{"id":"adffbc02","executionInfo":{"status":"ok","timestamp":1672557260522,"user_tz":-540,"elapsed":850,"user":{"displayName":"OTSU Kazuki","userId":"14035042482188716345"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"551ddc81-e381-4b66-8d28-d81f87875e5f"},"outputs":[{"output_type":"stream","name":"stderr","text":["<ipython-input-24-9fcc42f0a302>:1: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame.\n","Try using .loc[row_indexer,col_indexer] = value instead\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  df_unique['Hour'] = df_unique['Time']\n","<ipython-input-24-9fcc42f0a302>:3: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame.\n","Try using .loc[row_indexer,col_indexer] = value instead\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  df_unique['Hour'] = pd.to_datetime(df_unique[\"Hour\"])\n","<ipython-input-24-9fcc42f0a302>:4: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame.\n","Try using .loc[row_indexer,col_indexer] = value instead\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  df_unique['Hour'] = df_unique['Hour'].dt.floor('H')\n"]},{"output_type":"stream","name":"stdout","text":["cat: /drive/My: No such file or directory\n","cat: Drive/修論/pandas書き出し/1028id平均_一時間.csv: No such file or directory\n","                              x_pt           y_pt  type      Distance  \\\n","Hour                                                                    \n","2022-10-28 08:00:00  -23477.199004   82416.641918   0.0  1.105027e+06   \n","2022-10-28 09:00:00    8580.144680  344261.021630   0.0  3.287364e+07   \n","2022-10-28 10:00:00  -84742.133495   77876.653541   0.0  5.161661e+07   \n","2022-10-28 11:00:00  -46741.199870   20640.378746   0.0  1.156593e+08   \n","2022-10-28 12:00:00  113597.228326   38747.667801   0.0  1.460573e+08   \n","2022-10-28 13:00:00  101326.545000   36351.554275   0.0  7.115946e+07   \n","2022-10-28 14:00:00   91711.022727   18807.544324   0.0  9.098641e+07   \n","2022-10-28 15:00:00   81588.437057    5250.113047   0.0  5.969427e+07   \n","2022-10-28 16:00:00  108375.767028  121793.287635   0.0  4.850746e+07   \n","2022-10-28 17:00:00  205099.587872  113171.435852   0.0  2.541033e+07   \n","2022-10-28 18:00:00 -307218.470414  -57643.513131   0.0  2.284897e+07   \n","2022-10-28 19:00:00  113717.425756   29151.268486   0.0  8.606233e+06   \n","\n","                       idsub  Posture  TimeDifferent   ID  \n","Hour                                                       \n","2022-10-28 08:00:00    30165   3933.0       1584.591   13  \n","2022-10-28 09:00:00   662010  19416.0      33327.348   61  \n","2022-10-28 10:00:00  1284474  21407.0      68418.356   71  \n","2022-10-28 11:00:00  1696494  18413.0     109842.528   73  \n","2022-10-28 12:00:00  3201566  23293.0     165890.789  105  \n","2022-10-28 13:00:00  4606169  25030.0     127760.139   84  \n","2022-10-28 14:00:00  3157037  14477.0     163305.937   70  \n","2022-10-28 15:00:00  4940103  18920.0     136335.130   64  \n","2022-10-28 16:00:00  4545491  15229.0      89298.804   62  \n","2022-10-28 17:00:00  4493742  15409.0     168354.641   70  \n","2022-10-28 18:00:00  3829838  11754.0     219147.077   68  \n","2022-10-28 19:00:00  2512703   7453.0      86095.325   41  \n","cat: /drive/My: No such file or directory\n","cat: Drive/修論/pandas書き出し/1028元データ_一時間.csv: No such file or directory\n"]}],"source":["\n","df_unique['Hour'] = df_unique['Time']\n","\n","df_unique['Hour'] = pd.to_datetime(df_unique[\"Hour\"])\n","df_unique['Hour'] = df_unique['Hour'].dt.floor('H')\n","df_u_count = df_unique.groupby('Hour').sum()\n","\n","df_unique_id = df_unique.groupby('Hour').nunique()\n","\n","df_IDconfig_5min['Hour'] = df_IDconfig_5min['Time']\n","df_IDconfig_5min['Hour'] = pd.to_datetime(df_IDconfig_5min['Hour'])\n","df_IDconfig_5min['Hour'] = df_IDconfig_5min['Hour'].dt.floor('5T')\n","\n","df_IDconfig_5min = df_IDconfig_5min.groupby('Hour')['idsub'].nunique().reset_index()\n","df_IDconfig_5min['Hour'] = df_IDconfig_5min['Hour'].dt.floor('H')\n","df_IDconfig_5min = df_IDconfig_5min.groupby('Hour')['idsub'].mean()\n","\n","with open('drive/My Drive/修論/pandas書き出し/1028id平均_一時間.csv', 'w', encoding = 'utf-8-sig') as f:\n","  df_IDconfig_5min.to_csv(f)\n","!cat /drive/My Drive/修論/pandas書き出し/1028id平均_一時間.csv\n","\n","\n","df_u_count['ID'] = df_unique_id['idsub']\n","\n","print(df_u_count)\n","with open('drive/My Drive/修論/pandas書き出し/1028元データ_一時間.csv', 'w', encoding = 'utf-8-sig') as f:\n","  df_u_count.to_csv(f)\n","!cat /drive/My Drive/修論/pandas書き出し/1028元データ_一時間.csv"],"id":"adffbc02"}],"metadata":{"colab":{"provenance":[{"file_id":"1r9M0JfBkoAnLyYiWkJTRsu1-jzTfNJsn","timestamp":1672117185579},{"file_id":"1ZqfOhVWb9BghmSVdYTW6Uh_W6bmaVN40","timestamp":1672061471042},{"file_id":"1dVKjzrT6SoqydJoKkGKfXKe0-Oq5Jk-Y","timestamp":1671505341222}],"history_visible":true},"kernelspec":{"display_name":"Python 3 (ipykernel)","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.13"}},"nbformat":4,"nbformat_minor":5}